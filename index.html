<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CM Card</title>

<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#5b5bf7">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="CM Card">

<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" type="image/png" href="icon-192.png">


<style>
:root{
  --bg:#f5f6fa;
  --text:#000;
  --border:#e5e5ea;
  --primary:#5b5bf7;
  --card1:#0f9d58;
  --card2:#0b7a44;
}

body.dark{
  --bg:#0b0b0c;
  --text:#f5f5f7;
  --border:#2a2a2c;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}

/* HEADER */
.header{
  padding:25px 20px 10px;
}

.header small{
  opacity:.6;
  font-size:14px;
}

.header h1{
  margin:4px 0;
  font-size:30px;
}

.header p{
  opacity:.6;
  font-size:14px;
}

/* ========================= */
/* MAIN STRUCTURE FIX (NO CAMBIA TU DISE√ëO) */
/* ========================= */

.main{
  min-height:calc(100vh - 160px);
  display:flex;
  align-items:flex-start; /* volvemos arriba */
  justify-content:center;
  padding-top:40px;
  position:relative;
}

.wallet-blur-bg{
  position:absolute;
  inset:0;
  background:transparent; /* IMPORTANTE */
  backdrop-filter:blur(0px);
  -webkit-backdrop-filter:blur(0px);
  transition:backdrop-filter .4s ease;
  z-index:0;
  pointer-events:none;
}

#cards{
  position:relative;
  z-index:2;
}

/* ========================= */
/* MODAL AGREGAR TARJETA PREMIUM */
/* ========================= */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}

.modal.show{
  display:flex;
}

body.modal-open .tabbar,
body.modal-open .top-buttons{
  display:none;
  }

.modal-content{
  width:92%;
  max-width:380px;
  border-radius:32px;
  padding:28px 24px 30px;
  background:rgba(255,255,255,.85);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  box-shadow:
    0 30px 80px rgba(0,0,0,.25),
    inset 0 1px 1px rgba(255,255,255,.6);
  animation:modalPop .25s ease;

  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:stretch;
  gap:12px;
}

body.dark .modal-content{
  background:rgba(28,28,30,.85);
}

@keyframes modalPop{
  from{
    transform:scale(.92);
    opacity:0;
  }
  to{
    transform:scale(1);
    opacity:1;
  }
}

.modal-content h2{
  margin:0 0 10px 0;
  font-size:22px;
  font-weight:600;
  text-align:center;
}

.modal-content input,
.modal-content select{
  width:100%;
  padding:14px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.08);
  font-size:15px;
  background:rgba(255,255,255,.7);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  outline:none;
  transition:.2s;
}

body.dark .modal-content input,
body.dark .modal-content select{
  background:rgba(40,40,45,.7);
  border:1px solid rgba(255,255,255,.06);
}

.modal-content input:focus,
.modal-content select:focus{
  border:1px solid var(--primary);
  box-shadow:0 0 0 3px rgba(91,91,247,.15);
}

.modal-actions{
  display:flex;
  gap:14px;
  margin-top:18px;
}

.modal-actions button{
  flex:1;
  padding:14px;
  border-radius:20px;
  border:none;
  font-size:15px;
  font-weight:500;
  cursor:pointer;
  transition:.2s;
}

.modal-actions button:first-child{
  background:rgba(0,0,0,.06);
}

body.dark .modal-actions button:first-child{
  background:rgba(255,255,255,.08);
}

.modal-actions .primary-btn{
  background:linear-gradient(135deg,#5b5bf7,#7a6df9);
  color:#fff;
  box-shadow:0 10px 25px rgba(91,91,247,.35);
}

.modal-actions button:active{
  transform:scale(.96);
}

/* TAB BAR */

.tabbar {
  position: fixed;
  bottom: 22px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;

  height: 74px;
  width: 340px;

  display: flex;
  align-items: center;
  justify-content: space-around;

  border-radius: 42px;

  /* üßä VIDRIO REAL */
  background: rgba(255,255,255,0.18);
  backdrop-filter: blur(40px) saturate(180%) contrast(1.1);
  -webkit-backdrop-filter: blur(40px) saturate(180%) contrast(1.1);

  /* ‚ú® BORDE iOS */
  border: 1px solid rgba(255,255,255,0.18);

  /* üå´Ô∏è PROFUNDIDAD */
  box-shadow:
    0 30px 80px rgba(0,0,0,0.18),
    inset 0 1px 1px rgba(255,255,255,0.7);

  overflow: hidden;
}

.tab-indicator{
  position:absolute;
  height:60px;
  width:70px;
  border-radius:30px;

  background:rgba(255,255,255,0.35);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);

  box-shadow:
    0 15px 40px rgba(0,0,0,0.2),
    inset 0 1px 2px rgba(255,255,255,0.7);

  transition:
    left 0.35s cubic-bezier(.4,1.4,.6,1),
    width 0.25s ease,
    transform 0.25s ease;

  z-index:1;
}

.tab-icon-btn{
  position:relative;
  z-index:2;
}

.tabbar::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:42px;

  background: linear-gradient(
    to bottom,
    rgba(255,255,255,0.75),
    rgba(255,255,255,0.05) 40%,
    transparent
  );

  pointer-events:none;
}

.tabbar::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:42px;

  box-shadow:
    inset 0 -10px 20px rgba(0,0,0,0.08);

  pointer-events:none;
}

body.dark .tabbar {
  background: rgba(20,20,25,0.65);

  border: 1px solid rgba(255,255,255,0.08);

  box-shadow:
    0 35px 90px rgba(0,0,0,0.7),
    inset 0 1px 0 rgba(255,255,255,0.05);
}

body.dark .tabbar::before{
  background: linear-gradient(
    to bottom,
    rgba(255,255,255,0.08),
    transparent
  );
}


/* BOTONES TAB */

.tab-icon-btn{
  width:60px;
  height:60px;
  border-radius:18px;

  display:flex;
  align-items:center;
  justify-content:center;

  background: transparent; /* üî• clave */
  border: none;
  box-shadow: none;

  position: relative;
  overflow: hidden;

  transition: transform .2s ease;
}

.tab-icon-btn::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:18px;

  background: rgba(255,255,255,0.25);
  opacity:0;
  transform: scale(0.6);

  transition: all .25s cubic-bezier(.2,.8,.2,1);
}

body.dark .tab-icon-btn::after{
  background: rgba(255,255,255,0.12);
}

.tab-icon-btn:active::after{
  opacity:1;
  transform: scale(1);
}



/* üî• EFECTO PRESI√ìN iOS */
.tab-icon-btn:active{
  transform: scale(0.9);
  background: rgba(255,255,255,0.25);
  box-shadow:
    inset 0 2px 6px rgba(0,0,0,0.15);
}

.tab-icon-btn img{
  width:48px;
  height:48px;
  object-fit:contain;

  filter: brightness(0); /* negro por defecto */
  opacity:0.9;
}

body.dark .tab-icon-btn img{
  filter: brightness(0) invert(1); /* blanco */
}

body.dark .tab-indicator{
  box-shadow:
    0 15px 40px rgba(91,91,247,0.6),
    inset 0 1px 1px rgba(255,255,255,0.1);
}

body.dark .tab-icon-btn{
  background: transparent; /* üî• clave */

  box-shadow: none; /* ‚ùå elimina efecto flotante */
}

/* BOT√ìN MODO */
.top-buttons{
  position:fixed;
  top:20px;
  right:20px;

  display:flex;
  gap:12px;

  z-index:1000;
}

.qr-btn,
.theme-btn{
  width:48px;
  height:48px;
  border-radius:16px;

  background: rgba(255,255,255,0.18);
  backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%);

  border: 1px solid rgba(255,255,255,0.25);

  display:flex;
  align-items:center;
  justify-content:center;

  position:relative;
  overflow:hidden;

  transition: all .25s ease;
}

.qr-btn::after,
.theme-btn::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;

  background: rgba(255,255,255,0.3);
  opacity:0;
  transform: scale(0.7);

  transition:.25s;
}

body.dark .qr-btn::after,
body.dark .theme-btn::after{
  background: rgba(255,255,255,0.12);
}

.qr-btn:active::after,
.theme-btn:active::after{
  opacity:1;
  transform: scale(1);
}

body.dark .qr-btn,
body.dark .theme-btn{
  background-color:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.08);
}

/* QR SIEMPRE visible */
.qr-btn{
  background-image:url("qr.PNG") !important;
  background-repeat:no-repeat;
  background-position:center;
  background-size:80%;
}

/* Moon modo claro */
.theme-btn{
  background-image:url("moon.PNG");
  background-repeat:no-repeat;
  background-position:center;
  background-size:80%;
}

/* Sun modo oscuro */
body.dark .theme-btn{
  background-image:url("sun.PNG");
}

/* ========================= */
/* VENTANA PLACEHOLDER iOS GLASS */
/* ========================= */

.placeholder{
  width:100%;
  max-width:340px;
  padding:30px 24px;
  border-radius:32px;

  background:rgba(255,255,255,.65);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);

  box-shadow:
    0 30px 60px rgba(0,0,0,.15),
    inset 0 1px 1px rgba(255,255,255,.6);

  text-align:center;
  transition:.3s;
}

body.dark .placeholder{
  background:rgba(28,28,30,.7);
}

.placeholder .icon{
  font-size:48px;
  margin-bottom:14px;
}

.placeholder h3{
  margin:10px 0 8px 0;
  font-size:20px;
  font-weight:600;
}

.placeholder p{
  font-size:14px;
  opacity:.65;
  margin-bottom:20px;
}

.placeholder .primary-btn{
  padding:14px 22px;
  border-radius:22px;
  border:none;
  background:linear-gradient(135deg,#5b5bf7,#7a6df9);
  color:#fff;
  font-weight:500;
  font-size:15px;
  cursor:pointer;
  box-shadow:0 12px 30px rgba(91,91,247,.35);
  transition:.2s;
}

.placeholder .primary-btn:active{
  transform:scale(.96);
}
/* Ajuste fino centrado premium */
#cardModal .modal-content{
  padding:30px 28px 30px 20px;
}
/* ========================= */
/* CARRUSEL HORIZONTAL WALLET */
/* ========================= */

#cards{
  display:flex;
  flex-direction:row;
  gap:20px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  padding:20px 10px;
  scroll-behavior:smooth;
  perspective:1200px;
}

#cards::-webkit-scrollbar{
  display:none;
}
.card {
  position: relative;
  width: 320px;
  max-width: 90vw;
  height: 200px;
  border-radius: 24px;
  padding: 20px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  box-shadow: 
    0 20px 40px rgba(0,0,0,0.2),
    inset 0 1px 2px rgba(255,255,255,0.3);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  animation: floatCard 4s ease-in-out infinite;
  scroll-snap-align:center;
flex:0 0 85%;
transition: transform .35s cubic-bezier(.22,1,.36,1);
transform-style:preserve-3d;
}

.card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 30px 60px rgba(0,0,0,0.3),
              inset 0 1px 2px rgba(255,255,255,0.3);
}

@keyframes floatCard {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-6px); }
}

.card img.card-icon {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 40px;
  height: 40px;
  object-fit: contain;
}

.card h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.card p {
  margin: 2px 0;
  font-size: 14px;
  opacity: 0.8;
}

.card .card-actions {
  display: flex;
  gap: 10px;
}

.card .card-actions button {
  flex: 1;
  padding: 8px 12px;
  border-radius: 16px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  transition: transform 0.2s;
}

.card .card-actions button:first-child {
  background: rgba(0,0,0,0.08);
  color: var(--text);
}

body.dark .card .card-actions button:first-child {
  background: rgba(255,255,255,0.1);
}

.card .card-actions button:last-child {
  background: linear-gradient(135deg,#5b5bf7,#7a6df9);
  color: #fff;
  box-shadow: 0 6px 15px rgba(91,91,247,0.3);
}

.card .card-actions button:active {
  transform: scale(0.95);
}
/* ========================= */
/* SETTINGS MODAL */
/* ========================= */

.settings-box{
  max-width:320px;
  border-radius:20px;
}

.setting-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:18px 0;
}

.switch{
  position:relative;
  display:inline-block;
  width:46px;
  height:24px;
}

.switch input{
  opacity:0;
  width:0;
  height:0;
}

.slider{
  position:absolute;
  cursor:pointer;
  inset:0;
  background:#ccc;
  border-radius:34px;
  transition:.3s;
}

.slider:before{
  content:"";
  position:absolute;
  height:18px;
  width:18px;
  left:3px;
  bottom:3px;
  background:white;
  border-radius:50%;
  transition:.3s;
}

input:checked + .slider{
  background:#4f8cff;
}

input:checked + .slider:before{
  transform:translateX(22px);
}

.language-options{
  display:none;
  flex-direction:column;
  gap:10px;
}

.language-options button{
  padding:8px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

.company-footer{
  position:absolute;
  bottom:100px;
  left:0;
  right:0;
  text-align:center;
  font-size:12px;
  opacity:.6;
}

.close-modal {
  position: absolute;
  top: 12px;
  right: 12px;
  background: transparent;
  border: none;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: var(--text);
  transition: transform 0.2s;
}

.close-modal:active {
  transform: scale(0.9);
}

/* ========================= */
/* ACCIONES ULTRA GLASS */
/* ========================= */

#actionsModal .modal-content{
  border-radius:34px;
  padding:30px 24px;
  background:rgba(255,255,255,.55);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);

  box-shadow:
    0 40px 100px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.8);
}

body.dark #actionsModal .modal-content{
  background:rgba(20,20,25,.75);
  box-shadow:
    0 40px 100px rgba(0,0,0,.6),
    inset 0 1px 0 rgba(255,255,255,.05);
}

#actionsModal .modal-content h2{
  text-align:center;
  font-size:22px;
  font-weight:600;
  margin-bottom:20px;
}

/* Botones estilo Apple Pay */

#actionsModal button{
  padding:16px;
  border-radius:22px;
  border:none;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:.25s ease;

  background:rgba(255,255,255,.35);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);

  border:1px solid rgba(255,255,255,.5);
}

#actionsModal button:active{
  transform:scale(.95);
}

body.dark #actionsModal button{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
}

.quick-actions{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:16px;
  margin-bottom:40px;
}

/* VARIABLES BASE */
:root{
  --quick-bg-light: rgba(255,255,255,0.7);
  --quick-border-light: rgba(0,0,0,0.06);

  --quick-bg-dark: rgba(255,255,255,0.08);
  --quick-border-dark: rgba(255,255,255,0.08);
}

/* ESTILO GENERAL */
.quick-btn{
  height:95px;
  border-radius:22px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:8px;
  font-size:14px;
  font-weight:500;
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  transition: all .25s ease;
}

body:not(.dark) .quick-btn{
  background: rgba(255,255,255,0.7);
  border:1px solid rgba(0,0,0,0.06);
  box-shadow: 0 10px 25px rgba(0,0,0,0.05);
  color:#000;
}

body.dark .quick-btn{
  background: rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.1);
  color:#fff;
}

.quick-btn:active{
  transform: scale(.95);
}

.ios-list{
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  border-radius:22px;
  overflow:hidden;
  box-shadow:
    0 20px 50px rgba(0,0,0,0.08),
    inset 0 1px 0 rgba(255,255,255,0.6);
}

body.dark .ios-list{
  background: rgba(28,28,30,0.7);
}

.ios-item{
  padding:18px;
  border-bottom:1px solid rgba(255,255,255,0.08);
  font-size:16px;
}

.ios-item:last-child{
  border-bottom:none;
}

.ios-item:active{
  background:rgba(255,255,255,0.08);
}

/* ========================= */
/* SISTEMA DE PANTALLAS REAL */
/* ========================= */

.screen{
  position:fixed;
  inset:0;
  padding:25px 20px 120px 20px;
  background:var(--bg);
  color:var(--text);
  box-sizing:border-box;

  transform:translateX(100%);
  transition:transform .4s cubic-bezier(.25,.8,.25,1);
  overflow-y:auto;

  z-index:200;
}

.screen.active{
  transform:translateX(0);
}

@keyframes liquidDrop {
  0%{
    transform: scale(1) translateY(0);
    border-radius: 22px;
    opacity:1;
  }

  40%{
    transform: scale(1.05,.95);
    border-radius: 35px;
  }

  70%{
    transform: scale(.95,1.05);
    border-radius: 45px;
  }

  100%{
    transform: scale(.85) translateY(80px);
    border-radius: 60px;
    opacity:0;
  }
}

.card.liquid-exit{
  animation: liquidDrop .5s cubic-bezier(.22,1,.36,1) forwards;
}

</style>
</head>

<body>

<div class="top-buttons">
  <div class="qr-btn" onclick="generarQR()"></div>
  <div class="theme-btn" onclick="toggleTheme()"></div>
</div>

<div class="header">
  <small>Bienvenido a</small>
  <h1>CM Card</h1>
  <p>Gestiona tus tarjetas desde la comodidad de CM Card</p>
</div>


<div class="main">
  <div class="wallet-blur-bg" id="walletBlur"></div>
  <div id="cards">
    <div class="placeholder">
      <div class="icon">üí≥</div>
      <h3>No tienes tarjetas</h3>
      <p>Agrega tu primera tarjeta magn√©tica para comenzar a usarla</p>
      <button class="primary-btn" onclick="openModal()">+ Agregar Tarjeta</button>
    </div>
  </div>
</div>

<div id="actionsScreen" class="screen">

  <!-- Header -->
 <div style="
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  margin-bottom:25px;
">
   <button onclick="volverHome()" 
  style="
    position:absolute;
    left:0;
    background:none;
    border:none;
    font-size:22px;
    color:var(--text);
">
  ‚Üê
</button>

   <h2 style="margin:0;">
  Acciones
</h2>
  </div>

  <!-- Tarjeta -->
  <div id="cardPreviewContainer" style="margin-bottom:25px;"></div>

  <!-- Botones r√°pidos -->
<div class="quick-actions">

  <button class="quick-btn" onclick="runUSSD('*444*40*03#')">
    <span style="font-size:22px;">üîê</span>
    <span>Autenticar</span>
  </button>

  <button class="quick-btn" onclick="runUSSD('*444*46#')">
    <span style="font-size:22px;">üí∞</span>
    <span>Consultar</span>
  </button>

  <button class="quick-btn" onclick="runUSSD('*444*45#')">
    <span style="font-size:22px;">‚úàÔ∏è</span>
    <span>Transferir</span>
  </button>

  <button class="quick-btn" onclick="runUSSD('*444*54#')">
    <span style="font-size:22px;">üì≤</span>
    <span>Recargar</span>
  </button>

</div>

  <!-- T√≠tulo -->
  <h3 style="margin-bottom:15px;">Consultas</h3>

  <!-- Lista -->
  <div class="ios-list">

    <div class="ios-item" onclick="runUSSD('*444*46#')">
      Consultar Saldo
    </div>

    <div class="ios-item" onclick="runUSSD('*444*58#')">
      Consulta Todas las Cuentas
    </div>

    <div class="ios-item">
      Tipo de Cambio
    </div>

    <div class="ios-item">
      Informaci√≥n Tarjeta Red
    </div>

  </div>

</div>

<div class="tabbar">
  
  <div class="tab-indicator"></div>
  
<div class="tab-icon-btn active" onclick="openModal()">
    <img src="agregar.PNG">
  </div>

<div class="tab-icon-btn" onclick="openActions()">
  <img src="acciones.PNG">
</div>

<div class="tab-icon-btn" onclick="openSettings()">
  <img src="ajustes.PNG">
</div>

</div> <!-- CIERRE DE TABBAR -->


<div id="cardModal" class="modal">
  <div class="modal-content">
    <h2>Agregar tarjeta</h2>

    <input type="text" placeholder="Titular">
    <input id="cardNumber" type="text" placeholder="N√∫mero de tarjeta" maxlength="16">
    <input id="expiry" type="text" placeholder="Vencimiento (MM/YY)" maxlength="5">
    <input id="pin" type="text" placeholder="PIN" maxlength="4">

    <select id="currency">
      <option value="">Seleccionar moneda</option>
      <option>USD</option>
      <option>EUR</option>
      <option>CUP</option>
    </select>

    <input id="phone" type="text" placeholder="N√∫mero de celular">

    <div class="modal-actions">
      <button onclick="closeModal()">Cancelar</button>
   <button class="primary-btn" onclick="guardarTarjeta()">Guardar</button>
    </div>
 
   </div>
 </div>

 <!-- ========================= -->
<!-- MODAL AJUSTES -->
<!-- ========================= -->

<div id="settingsScreen" class="screen">

  <div style="
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    margin-bottom:25px;
  ">
    <button onclick="volverDesdeSettings()" 
      style="
        position:absolute;
        left:0;
        background:none;
        border:none;
        font-size:22px;
        color:var(--text);
    ">
      ‚Üê
    </button>

    <h2 style="margin:0;" data-i18n="settingsTitle">Ajustes</h2>
  </div>

  <div class="ios-list">

    <div class="ios-item">
      <span data-i18n="darkMode">Modo Oscuro</span>
      <label class="switch" style="float:right;">
        <input type="checkbox" id="darkToggleScreen">
        <span class="slider"></span>
      </label>
    </div>

    <div class="ios-item">
      <span data-i18n="language">Idioma</span>
      <button id="languageBtnScreen" style="float:right;">Espa√±ol</button>
    </div>

    <div class="language-options" id="languageOptionsScreen">
      <button onclick="setLanguage('es')">Espa√±ol</button>
      <button onclick="setLanguage('en')">English</button>
    </div>

 </div> <!-- cierre ios-list -->

<div class="company-footer">
  CM "55384064" Company
</div>

  </div>

</div>
    

<!-- ========================= -->
<!-- MODAL ACCIONES -->
<!-- ========================= -->



<div class="modal" id="qrModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeQR()">‚úï</button>
    <h2>C√≥digo QR</h2>
    <div id="qrcode" style="margin:auto;"></div>
  </div>
</div>

<div class="modal" id="scannerModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeScanner()">‚úï</button>
    <h2>Escanear QR</h2>
    <div id="reader" style="width:100%;"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
let tarjetas = JSON.parse(localStorage.getItem("tarjetas")) || [];
let editingIndex = null;
let selectedCardIndex = null;

/* ========================= */
/* THEME */
/* ========================= */

function toggleTheme(){
  document.body.classList.toggle("dark");

  localStorage.setItem(
    "theme",
    document.body.classList.contains("dark") ? "dark" : "light"
  );
}

/* ========================= */
/* MODAL */
/* ========================= */

function openModal(){
  document.getElementById("cardModal").classList.add("show");
}

function closeModal(){
  document.getElementById("cardModal").classList.remove("show");
}

function openSettings(){

  moveIndicator(document.querySelectorAll(".tab-icon-btn")[2]);

  document.getElementById("settingsScreen").classList.add("active");

  document.querySelector(".top-buttons").style.display="none";

  const darkToggle = document.getElementById("darkToggleScreen");

  darkToggle.checked = document.body.classList.contains("dark");

  darkToggle.onchange = function(){
    document.body.classList.toggle("dark", this.checked);
    localStorage.setItem("theme", this.checked ? "dark" : "light");
  };
}

function volverDesdeSettings(){

  const screen = document.getElementById("settingsScreen");

  screen.classList.remove("active");
  screen.scrollTop = 0;

  document.querySelector(".top-buttons").style.display="flex";

  moveIndicator(document.querySelectorAll(".tab-icon-btn")[0]);
}

function openActions(){

  if(selectedCardIndex === null){
    alert("Selecciona una tarjeta primero");
    return;
  }

  moveIndicator(document.querySelectorAll(".tab-icon-btn")[1]);

  document.getElementById("actionsScreen").classList.add("active");

  document.querySelector(".top-buttons").style.display="none";

  const tarjetaSeleccionada =
    document.querySelectorAll(".card")[selectedCardIndex];

  document.getElementById("cardPreviewContainer").innerHTML =
    tarjetaSeleccionada.outerHTML;
}

function volverHome(){

  document.getElementById("actionsScreen").classList.remove("active");

  document.querySelector(".top-buttons").style.display="flex";

  moveIndicator(document.querySelectorAll(".tab-icon-btn")[0]);
}
  
function runUSSD(code){
  window.location.href = "tel:" + encodeURIComponent(code);
}

/* ========================= */
/* FORM VALIDATION */
/* ========================= */

document.addEventListener("DOMContentLoaded", () => {

  renderCards();

  const cardNumber = document.getElementById("cardNumber");
  const expiry = document.getElementById("expiry");
  const pin = document.getElementById("pin");
  const phone = document.getElementById("phone");

  function onlyNumbers(el){
    el.value = el.value.replace(/\D/g,'');
  }

  cardNumber.addEventListener("input", () => {
    onlyNumbers(cardNumber);
    cardNumber.value = cardNumber.value.slice(0,16);
  });

  pin.addEventListener("input", () => {
    onlyNumbers(pin);
    pin.value = pin.value.slice(0,4);
  });

  phone.addEventListener("input", () => {
    onlyNumbers(phone);
  });

  expiry.addEventListener("input", () => {
    let v = expiry.value.replace(/\D/g,'').slice(0,4);
    expiry.value = v.length > 2 ? v.slice(0,2)+"/"+v.slice(2) : v;
  });

});

/* ========================= */
/* GUARDAR TARJETA */
/* ========================= */

function guardarTarjeta(){

  const titular = document.querySelector("#cardModal input[placeholder='Titular']").value.trim();
  const cardNumber = document.getElementById("cardNumber").value.trim();
  const expiry = document.getElementById("expiry").value.trim();
  const pin = document.getElementById("pin").value.trim();
  const currency = document.getElementById("currency").value;
  const phone = document.getElementById("phone").value.trim();

  if(!titular || !cardNumber || !expiry || !pin || !currency || !phone){
    alert("Completa todos los campos");
    return;
  }

  const nuevaTarjeta = { titular, cardNumber, expiry, pin, currency, phone };

  if(editingIndex !== null){
    tarjetas[editingIndex] = nuevaTarjeta;
    editingIndex = null;
  } else {
    tarjetas.push(nuevaTarjeta);
  }

  localStorage.setItem("tarjetas", JSON.stringify(tarjetas)); 

  limpiarFormulario();
  closeModal();
  renderCards();
}

/* ========================= */
/* LIMPIAR FORM */
/* ========================= */

function limpiarFormulario(){
  document.querySelector("#cardModal input[placeholder='Titular']").value = "";
  document.getElementById("cardNumber").value = "";
  document.getElementById("expiry").value = "";
  document.getElementById("pin").value = "";
  document.getElementById("currency").value = "";
  document.getElementById("phone").value = "";
}

/* ========================= */
/* RENDER CARDS PREMIUM */
/* ========================= */

function renderCards(){

  const container = document.getElementById("cards");
  container.innerHTML = "";

  if(tarjetas.length === 0){
    container.innerHTML = `
      <div class="placeholder">
        <div class="icon">üí≥</div>
        <h3>No tienes tarjetas</h3>
        <p>Agrega tu primera tarjeta magn√©tica para comenzar a usarla</p>
        <button class="primary-btn" onclick="openModal()">+ Agregar Tarjeta</button>
      </div>
    `;
    return;
  }

  tarjetas.forEach((tarjeta, index) => {

    const card = document.createElement("div");
    card.classList.add("card");
    card.addEventListener("click", function(e){

  // Evita que se active si toc√≥ editar o eliminar
  if(e.target.tagName === "BUTTON") return;

  selectedCardIndex = index;

  document.querySelectorAll(".card").forEach(c=>{
    c.style.outline = "none";
  });

  card.style.outline = "3px solid #ffffff";
});

    /* ===== 1Ô∏è‚É£ GRADIENTE DIN√ÅMICO SEG√öN MONEDA ===== */

    let gradient;

    switch(tarjeta.currency){
      case "USD":
        gradient = "linear-gradient(135deg,#1e3c72,#2a5298)";
        break;
      case "EUR":
        gradient = "linear-gradient(135deg,#42275a,#734b6d)";
        break;
      case "CUP":
        gradient = "linear-gradient(135deg,#134e5e,#71b280)";
        break;
      default:
        gradient = "linear-gradient(135deg,#5b5bf7,#7a6df9)";
    }

    card.style.background = gradient;
    card.style.color = "#fff";

    /* ===== 2Ô∏è‚É£ SOLO √öLTIMOS 4 D√çGITOS ===== */

    const last4 = tarjeta.cardNumber.slice(-4);

    card.innerHTML = `
      <img src="logo.png" class="card-icon">
      <div style="margin-top:50px">
        <h3>${tarjeta.titular}</h3>
        <p>‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ${last4}</p>
        <p>Vence: ${tarjeta.expiry}</p>
        <p>${tarjeta.currency}</p>
      </div>
      <div class="card-actions">
        <button onclick="editCard(${index})">Editar</button>
        <button onclick="deleteCard(${index})">Eliminar</button>
      </div>
    `;

    /* ===== 4Ô∏è‚É£ ANIMACI√ìN TIPO WALLET AL APARECER ===== */

    card.style.opacity = "0";
    card.style.transform = "translateY(40px) scale(0.95)";
    card.style.transition = "all .4s cubic-bezier(.25,.8,.25,1)";

    setTimeout(() => {
      card.style.opacity = "1";
      card.style.transform = "translateY(0px) scale(1)";
    }, 100);

    container.appendChild(card);

  });
}

/* ========================= */
/* EDITAR */
/* ========================= */

function editCard(index){

  const tarjeta = tarjetas[index];
  editingIndex = index;

  document.querySelector("#cardModal input[placeholder='Titular']").value = tarjeta.titular;
  document.getElementById("cardNumber").value = tarjeta.cardNumber;
  document.getElementById("expiry").value = tarjeta.expiry;
  document.getElementById("pin").value = tarjeta.pin;
  document.getElementById("currency").value = tarjeta.currency;
  document.getElementById("phone").value = tarjeta.phone;

  openModal();
}

/* ========================= */
/* ELIMINAR */
/* ========================= */

function deleteCard(index){

  if(confirm("¬øEliminar esta tarjeta?")){
    tarjetas.splice(index,1);
    localStorage.setItem("tarjetas", JSON.stringify(tarjetas));
    renderCards();
  }
}
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker registrado"))
      .catch(err => console.log("Error SW:", err));
  });
}


/* ========================= */
/* GENERAR QR */
/* ========================= */

function generarQR(){

  if(selectedCardIndex === null){
    alert("Selecciona una tarjeta primero");
    return;
  }

  const tarjeta = tarjetas[selectedCardIndex];

  document.getElementById("qrModal").classList.add("show");

  document.getElementById("qrcode").innerHTML = "";

  new QRCode(document.getElementById("qrcode"), {
    text: JSON.stringify(tarjeta),
    width:200,
    height:200
  });
}

function closeQR(){
  document.getElementById("qrModal").classList.remove("show");
}

/* ========================= */
/* EFECTO WALLET DIN√ÅMICO 3D */
/* ========================= */

const cardsContainer = document.getElementById("cards");
const blurBg = document.getElementById("walletBlur");

function updateCardEffects() {
  const cards = document.querySelectorAll(".card");
  const containerCenter = cardsContainer.offsetWidth / 2;

  cards.forEach(card => {
    const rect = card.getBoundingClientRect();
    const cardCenter = rect.left + rect.width / 2;
    const offset = cardCenter - containerCenter;

    const distance = Math.abs(offset);
    const maxDistance = containerCenter;

    const scale = 1 - Math.min(distance / maxDistance, 0.3);
    const rotateY = offset / 20;

    card.style.transform = `
      scale(${scale})
      rotateY(${rotateY}deg)
    `;
  });
  let closestDistance = Infinity;

cards.forEach(card => {
  const rect = card.getBoundingClientRect();
  const cardCenter = rect.left + rect.width / 2;
  const offset = cardCenter - containerCenter;
  const distance = Math.abs(offset);

  if(distance < closestDistance){
    closestDistance = distance;
  }
});

const blurAmount = Math.min(closestDistance / 10, 20);
blurBg.style.backdropFilter = `blur(${blurAmount}px)`;
blurBg.style.webkitBackdropFilter = `blur(${blurAmount}px)`;
}

cardsContainer.addEventListener("scroll", updateCardEffects);
window.addEventListener("load", updateCardEffects);
window.addEventListener("resize", updateCardEffects);

document.addEventListener("DOMContentLoaded", function(){
  const darkToggle = document.getElementById("darkToggle");

  if(darkToggle){
    darkToggle.addEventListener("change", function(){
      document.body.classList.toggle("dark", this.checked);
      localStorage.setItem("theme", this.checked ? "dark" : "light");
      syncThemeIcon();
    });
  }
});

window.addEventListener("load", function(){
  const savedTheme = localStorage.getItem("theme");
  const darkToggle = document.getElementById("darkToggle");

  if(savedTheme === "dark"){
    document.body.classList.add("dark");
    if(darkToggle) darkToggle.checked = true;
  }

  const savedLang = localStorage.getItem("language") || "es";
  setLanguage(savedLang);
});



const translations = {
  es: {
    settingsTitle: "Ajustes",
    darkMode: "Modo Oscuro",
    language: "Idioma"
  },
  en: {
    settingsTitle: "Settings",
    darkMode: "Dark Mode",
    language: "Language"
  }
};
function setLanguage(lang){

  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.textContent = translations[lang][key];
  });

  const options = document.getElementById("languageOptionsScreen");
  const btn = document.getElementById("languageBtnScreen");

  if(options) options.style.display="none";

  if(btn){
    btn.textContent = lang === "es" ? "Espa√±ol" : "English";
  }

  localStorage.setItem("language", lang);
}

function toggleScanMenu(){
  document.getElementById("scanOptions").classList.toggle("show");
}


window.addEventListener("scroll", ()=>{
  const tabbar = document.querySelector(".tabbar");
  const scroll = window.scrollY;

  const blur = 30 + Math.min(scroll / 10, 20);

  tabbar.style.backdropFilter = `blur(${blur}px) saturate(180%)`;
});

const tabButtonsNew = document.querySelectorAll(".tab-icon-btn");
const indicator = document.querySelector(".tab-indicator");

function moveIndicator(element){

  const rect = element.getBoundingClientRect();
  const parentRect = element.parentElement.getBoundingClientRect();

  const left = rect.left - parentRect.left;

  indicator.style.width = rect.width * 0.9 + "px";
  indicator.style.left = left + (rect.width * 0.05) + "px";

  tabButtonsNew.forEach(btn=> btn.classList.remove("active"));
  element.classList.add("active");
}

tabButtonsNew.forEach(btn=>{
  btn.addEventListener("click", function(){

    indicator.style.transform = "scaleX(1.3)";
    moveIndicator(this);

    setTimeout(()=>{
      indicator.style.transform = "scaleX(1)";
    },150);

  });
});

window.addEventListener("load", ()=>{
  const activeBtn = document.querySelector(".tab-icon-btn.active");
  if(activeBtn){
    moveIndicator(activeBtn);
  }
});

let startX = 0;
let currentX = 0;
let isSwiping = false;

const actionsScreen = document.getElementById("actionsScreen");

actionsScreen.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
  isSwiping = startX < 40; // solo si empieza cerca del borde izquierdo
});

actionsScreen.addEventListener("touchmove", (e) => {
  if(!isSwiping) return;

  currentX = e.touches[0].clientX;
  let diff = currentX - startX;

  if(diff > 0){
    actionsScreen.style.transform = `translateX(${diff}px)`;
  }
});

actionsScreen.addEventListener("touchend", () => {
  if(!isSwiping) return;

  let diff = currentX - startX;

  if(diff > 120){
    volverHome(); // vuelve atr√°s
  } else {
    actionsScreen.style.transform = "";
  }

  isSwiping = false;
});

const settingsScreen = document.getElementById("settingsScreen");

settingsScreen.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
  isSwiping = startX < 40;
});

settingsScreen.addEventListener("touchmove", (e) => {
  if(!isSwiping) return;

  currentX = e.touches[0].clientX;
  let diff = currentX - startX;

  if(diff > 0){
    settingsScreen.style.transform = `translateX(${diff}px)`;
  }
});

settingsScreen.addEventListener("touchend", () => {
  if(!isSwiping) return;

  let diff = currentX - startX;

  if(diff > 120){
    volverDesdeSettings();
  } else {
    settingsScreen.style.transform = "";
  }

  isSwiping = false;
});

</script>

</body>
</html>